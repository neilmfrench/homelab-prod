---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: campsearch-worker
spec:
  values:
    image:
      repository: harbor.${SECRET_DOMAIN}/campsearch/worker
      pullPolicy: IfNotPresent
      tag: "0.0.6"
    imagePullSecrets:
      - name: harbor-neilfrench-regcred
    controller:
      replicas: 5
    env:
      PB_ADDR: "http://pocketbase.development.svc.cluster.local:8090"
      PB_USERNAME: "campsite_bot"
      REDIS_ADDR: "campsearch-redis-master:6379"
      POD_NAME:
        valueFrom:
          fieldRef:
            fieldPath: metadata.name
    envFrom:
      - secretRef:
          name: campsearch-worker-secrets
    service:
      main:
        enabled: false
