---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: mysql
spec:
  values:
    architecture: standalone
    primary:
      persistence:
        existingClaim: ghost-mysql-data
    auth:
      rootPassword: "${SECRET_GHOST_MAG_MYSQL_PASSWORD}"
      database: ghost
      username: ghost
      password: "${SECRET_GHOST_MAG_MYSQL_PASSWORD}"
      replicationPassword: "${SECRET_GHOST_MAG_MYSQL_PASSWORD}"
  postRenderers:
    - kustomize:
        patchesJson6902:
          - target:
              kind: StatefulSet
              name: ghost-mysql
            patch:
              - op: replace
                path: /spec/replicas
                value: 0
