---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: tekton-operator
spec:
  interval: 5m
  releaseName: tekton-operator
  chart:
    spec:
      chart: chart
      sourceRef:
        kind: GitRepository
        name: tekton-chart
        namespace: flux-system
  maxHistory: 3
  install:
    remediation:
      retries: 3
  upgrade:
    remediation:
      retries: 3
  uninstall:
    keepHistory: false
  # postRenderers:
  #   - kustomize:
  #       # Waiting for merge of https://github.com/tektoncd/operator/pull/1278
  #       patchesJson6902:
  #         - target:
  #             kind: ClusterRole
  #             name: tekton-operator
  #           patch:
  #             - op: add
  #               path: /rules/-
  #               value:
  #                 apiGroups:
  #                   - tekton.dev
  #                 resources:
  #                   - customruns
  #                   - customruns/status
  #                   - customruns/finalizers
  #                 verbs:
  #                   - get
  #                   - list
  #                   - create
  #                   - update
  #                   - delete
  #                   - deletecollection
  #                   - patch
  #                   - watch
  #             - op: add
  #               path: /rules/-
  #               value:
  #                 apiGroups:
  #                   - networking.k8s.io
  #                 resources:
  #                   - ingresses
  #                   - ingresses/status
  #                 verbs:
  #                   - delete
  #                   - create
  #                   - patch
  #                   - get
  #                   - list
  #                   - update
  #                   - watch
  #             - op: add
  #               path: /rules/-
  #               value:
  #                 apiGroups:
  #                   - batch
  #                 resources:
  #                   - jobs
  #                 verbs:
  #                   - delete
  #                   - create
  #                   - patch
  #                   - get
  #                   - list
  #                   - update
  #                   - watch
